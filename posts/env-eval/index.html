<!DOCTYPE html>
<html>

<head>
  

  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Environment Variables as a Program Bootstrap  &middot; cloud daydreams</title>
  <link rel="icon" href="/favicon.ico" type="image/x-icon">
  <link rel="canonical" href="https://arrjay.github.io/posts/env-eval/">
  
  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/dracula.min.css">
  <link rel="stylesheet" href="/css/styles.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
</head>

<body>
  <div class="navbar">
    <ul>
      <li><a href="/" class="logo-title">INDEX</a></li>
      <li><a href="/categories">CATEGORIES</a></li>
      <li><a href="/tags">TAGS</a></li>
    </ul>
  </div>
  <div class="container">
    <div class="title">
      <a href="/">
        <img src="/images/logo.png" width="260px" height="48px" />
      </a>
    </div>


<a href="https://arrjay.github.io/posts/env-eval/">
  <div class="post-title">
    <img src="/images/post-title-icon.png" />
    <div class="post-meta">
      <time>13 Jul 2018, 15:47</time>
      <h1>Environment Variables as a Program Bootstrap</h1>
    </div>
  </div>
</a>

<div class="post-toc">
  <span class="title">
    Table of contents
  </span>
  <nav id="TableOfContents">
<ul>
<li><a href="#environment-variables-as-a-program-bootstrap">Environment Variables as a Program Bootstrap</a></li>
<li><a href="#an-example-with-ssh-agent">An example with ssh-agent</a>
<ul>
<li><a href="#command-substitution-output-into-a-string">Command substitution - output into a string</a></li>
<li><a href="#string-evaluation-running-the-contents-of-a-string">String evaluation - running the contents of a string</a></li>
<li><a href="#gluing-it-all-together">Gluing it all together</a></li>
</ul></li>
</ul>
</nav>
</div>

<section class="post-content">
  

<h1 id="environment-variables-as-a-program-bootstrap">Environment Variables as a Program Bootstrap</h1>

<p>Previously, I talked about <a href="/posts/environment/">environment variables</a> relating to system level environment variables. This article expands
on that with an examples of a program that uses <em>your</em> environment to flexibly communitacte between components, demonstrating ways to
effectively use those.</p>

<h1 id="an-example-with-ssh-agent">An example with ssh-agent</h1>

<p>Using <code>ssh-agent</code> is a way to improve the usability of encrypted ssh keys - that is, you can have keys stored encrypted on disk, and the agent
program will manage loading and unlocking keys for you. This improves usability of SSH - you no longer need to type a password to unlock your
key for every new ssh invocation. Rather, the agent program holds unencrypted keys in memory and re-locks them after a timeout.</p>

<p>Running <code>ssh-agent</code> from your shell produces something like the following output:<a name="ssh-agent-output"></a></p>

<pre><code>SSH_AUTH_SOCK=/tmp/ssh-Y4hQHDP2EEY9/agent.2009; export SSH_AUTH_SOCK;
SSH_AGENT_PID=2010; export SSH_AGENT_PID;
echo Agent pid 2010;
</code></pre>

<p>Referencing the previous post on environment variables, this output can actually be run as a shell script! It is setting up <code>SSH_AUTH_SOCK</code>
and <code>SSH_AGENT_PID</code> for other programs that support <code>ssh-agent</code>. In typical shells, we <em>can</em> induce program output to be interpreted as
shell code. The keys to this are <code>$()</code> and <code>eval</code>.</p>

<h2 id="command-substitution-output-into-a-string">Command substitution - output into a string</h2>

<p>The first step is to get the <em>text output</em> of <code>ssh-agent</code> as a string for our shell. That is achieved via the <code>$()</code> shell construct, it
runs the program specified inside and returns the standard output to us. Here&rsquo;s a simple example:</p>

<pre><code>$ uname -p
x86_64
$ CPU=&quot;uname -p&quot;
$ echo $CPU
uname -p
$ CPU=$(uname -p)
$ echo $CPU
x86_64
</code></pre>

<p>Notice how there was a difference between assigning a variable as a simple name, and running <code>uname -p</code>, then assigning the result.</p>

<h2 id="string-evaluation-running-the-contents-of-a-string">String evaluation - running the contents of a string</h2>

<p>The next step here is <code>eval</code> - take a string, and run the contents of that string as if you had typed it in your shell. So, returning to
our <a href="#ssh-agent-output">ssh-agent</a> example - read the output as a commands you had typed yourself! It sets and exports <code>SSH_AUTH_SOCK</code> and
<code>SSH_AGENT_PID</code>, then tells you the PID on our screen.</p>

<h2 id="gluing-it-all-together">Gluing it all together</h2>

<p>The following example is pretty short, just showing how it all glues together to actually let the program do the work for you:</p>

<pre><code>$ printenv SSH_AGENT_PID
$ eval $(ssh-agent)
Agent pid 109
$ printenv SSH_AGENT_PID
printenv SSH_AGENT_PID
</code></pre>

<p>Remember, the printenv command here does check to see your variable is exported - so now other programs can easily use the SSH agent.</p>

</section>

<div class="share">
  <a href="http://www.facebook.com/sharer.php?src=bm&u=https%3a%2f%2farrjay.github.io%2fposts%2fenv-eval%2f&t=Environment%20Variables%20as%20a%20Program%20Bootstrap" onclick="window.open(this.href, 'PCwindow', 'width=550, height=350, menubar=no, toolbar=no, scrollbars=yes'); return false;"><i class="fa fa-facebook"></i></a>
  <a href="http://twitter.com/intent/tweet?url=https%3a%2f%2farrjay.github.io%2fposts%2fenv-eval%2f&text=Environment%20Variables%20as%20a%20Program%20Bootstrap&tw_p=tweetbutton" onclick="window.open(this.href, 'PCwindow', 'width=550, height=350, menubar=no, toolbar=no, scrollbars=yes'); return false;"><i class="fa fa-twitter"></i></a>
  <a href="https://plus.google.com/share?url=https%3a%2f%2farrjay.github.io%2fposts%2fenv-eval%2f" onclick="window.open(this.href, 'PCwindow', 'width=550, height=350, menubar=no, toolbar=no, scrollbars=yes'); return false;"><i class="fa fa-google-plus"></i></a>
  <a href="http://getpocket.com/edit?url=https%3a%2f%2farrjay.github.io%2fposts%2fenv-eval%2f&title=Environment%20Variables%20as%20a%20Program%20Bootstrap" onclick="window.open(this.href, 'PCwindow', 'width=550, height=350, menubar=no, toolbar=no, scrollbars=yes'); return false;"><i class="fa fa-get-pocket"></i></a>
</div>

<div class="post-meta-code">
  <div class="desc">
    public string description() {
    <div class="desc">val author = "
    
        <a href="mailto:rbergero@gmail.com">RJ Bergeron</a>
    ";
    </div>
    
    <div class="desc">
      val categories = [
      
      
      <a href="https://arrjay.github.io//categories/software">"software"</a>
      
      <a href="https://arrjay.github.io//categories/nix">"nix"</a>
      
      ];
    </div>
    
    }
  </div>
  <div class="desc">
    public string tags() {
      <div class="desc">
        val tags = [
        
          
          <a href="https://arrjay.github.io/tags/bash">"bash"</a>
          
          <a href="https://arrjay.github.io/tags/ssh">"ssh"</a>
          
        
        ];
      </div>
    }
  </div>
</div>


<div class="post-comment">
  
</div>

<div class="paging post-paging">
  
  
  <a class="right" href="https://arrjay.github.io/posts/chroot/" rel="next">
    <span>The Foundation of Containerization - chroot</span> <i class="fa fa-caret-right" aria-hidden="true"></i>
  </a>
  
</div>

<footer class="footer">
  Copyright (C) RJ Bergeron, All Rights Reserved.<br>
  Theme by <a href="https://blog.lulab.net">DONGGEUN,BANG</a>
</footer>

</body>
</html>

